<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Hidden in Plain Sight</title>

  <style>
    :root {
      --bg-color: #f2f2f2;
      --text-color: #222;
      --card-bg: rgba(255, 255, 255, 0.92);
    }

    body {
      font-family: system-ui, sans-serif;
      padding: 2rem;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      touch-action: manipulation;
    }

    h1 { margin: 0 0 0.5rem; }
    h2 { margin: 0.5rem 0; }

    /* Poem (visible in light mode) */
    .poem-snippet {
      position: relative;
      margin: 0.5rem 0 2rem;
      font-style: italic;
      color: #444;
      text-align: center;
      max-width: 650px;
      z-index: 1;
      opacity: 0.9;
    }

    .container {
      display: flex;
      justify-content: space-between;
      width: 92%;
      max-width: 1200px;
      gap: 2rem;
      align-items: flex-start;
    }

    .image-game {
      flex: 1;
      text-align: center;
      padding: 1rem;
      background: var(--card-bg);
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }

    .image-display {
      max-width: 100%;
      max-height: 420px;
      border-radius: 8px;
      margin: 1rem auto;
      display: block;
      background: #ddd;
    }

    .scale-options {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 0.5rem;
      user-select: none;
    }

    .scale-options .label {
      font-weight: 700;
      opacity: 0.85;
      margin: 0 0.25rem;
    }

    .scale-options button {
      margin: 4px;
      padding: 10px 14px;
      font-size: 1.1rem;
      border: none;
      cursor: pointer;
      border-radius: 6px;
      background-color: #007bff;
      color: #fff;
    }

    .scale-options button:active { transform: translateY(1px); }

    /* Hidden by default in LIGHT mode (matches your old ‚Äúreveal‚Äù) */
    .info,
    .log {
      display: none;
      flex: 1;
      background: var(--card-bg);
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      overflow-y: auto;
    }

    .info {
      width: 92%;
      max-width: 1200px;
      margin: 0 0 1.5rem;
    }

    .log {
      max-height: 520px;
      font-size: 0.95rem;
      white-space: pre-line;
    }

    .log p { margin: 0.35rem 0; }

    /* Mobile layout */
    @media (max-width: 900px) {
      .container { flex-direction: column; }
      .log { max-height: 260px; }
    }

    /* =========================================================
       ‚úÖ PROACTIVE DARK MODE (JS toggles body.dark)
       This ensures immediate visual change when the OS theme flips.
    ========================================================== */
    body.dark {
      --bg-color: #121212;
      --text-color: #f2f2f2;
      --card-bg: #000;
    }

    body.dark,
    body.dark .info,
    body.dark .log,
    body.dark h1,
    body.dark h2 {
      color: #00ff00 !important;
      font-family: "Courier New", monospace;
    }

    body.dark .info,
    body.dark .log {
      display: block;
      background-color: black !important;
      border: 1px solid rgba(0,255,0,0.2);
      box-shadow: 0 0 0 rgba(0,0,0,0);
    }

    body.dark .image-game {
      background-color: #0b0b0b;
      border: 1px solid rgba(0,255,0,0.2);
      box-shadow: none;
    }

    body.dark h1,
    body.dark h2 {
      text-shadow: 0 0 5px #00ff00;
    }

    body.dark .poem-snippet {
      display: none;
    }

    body.dark ::-webkit-scrollbar { width: 8px; }
    body.dark ::-webkit-scrollbar-thumb { background-color: #00ff00; }

    /* üåô DARK MODE ONLY OVERRIDES (still supported) */
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-color: #121212;
        --text-color: #f2f2f2;
        --card-bg: #000;
      }

      body,
      .info,
      .log,
      h1,
      h2 {
        color: #00ff00 !important;
        font-family: "Courier New", monospace;
      }

      .info,
      .log {
        display: block;               /* reveal in dark mode */
        background-color: black !important;
        border: 1px solid rgba(0,255,0,0.2);
        box-shadow: 0 0 0 rgba(0,0,0,0);
      }

      .image-game {
        background-color: #0b0b0b;
        border: 1px solid rgba(0,255,0,0.2);
        box-shadow: none;
      }

      h1, h2 {
        text-shadow: 0 0 5px #00ff00;
      }

      .poem-snippet {
        display: none;                /* hide poem in dark mode */
      }

      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-thumb { background-color: #00ff00; }
    }
  </style>
</head>

<body>
  <h1>Hidden in Plain Sight</h1>

  <div class="poem-snippet" id="poemHint">
    <p>
      <em>
        What meets the eye may not be true,<br />
        In filtered light or altered hue.<br />
        A darker mode reveals the frame,<br />
        Where real and fake are not the same.
      </em>
    </p>
  </div>

  <!-- Device Info (reveals in dark mode) -->
  <div class="info" id="infoBox">
    <h2>Device Info</h2>
    <p><strong>User Agent:</strong> <span id="userAgent"></span></p>
    <p><strong>Screen Resolution:</strong> <span id="screenRes"></span></p>
    <p><strong>Platform:</strong> <span id="platform"></span></p>
    <p><strong>Device Type:</strong> <span id="deviceType"></span></p>
    <p><strong>Touch Support:</strong> <span id="touchSupport"></span></p>
    <p><strong>Dark Mode:</strong> <span id="darkMode"></span></p>
    <p><strong>Language:</strong> <span id="language"></span></p>
  </div>

  <div class="container">
    <!-- Game -->
    <div class="image-game" id="game-container">
      <h2>Is this a Real Photo?</h2>
      <img id="quiz-image" class="image-display" src="" alt="Guess if this is real or AI" />

      <div class="scale-options" aria-label="Rating scale">
        <span class="label">FAKE</span>
        <button onclick="submitGuess(1)">1</button>
        <button onclick="submitGuess(2)">2</button>
        <button onclick="submitGuess(3)">3</button>
        <button onclick="submitGuess(4)">4</button>
        <button onclick="submitGuess(5)">5</button>
        <span class="label">REAL</span>
      </div>
    </div>

    <!-- Activity Log (reveals in dark mode) -->
    <div class="log" id="log">
      <h2>Live Activity Log</h2>
    </div>
  </div>

<script>
  // ‚úÖ Local images hosted in your repo (fast + reliable)
  const imageSet = [
    { url: "images/TreeHouse_1.jpg", answer: "real", label: "Tree House" },
    { url: "images/TreeHouse_2.jpg", answer: "fake", label: "Tree House" },

    { url: "images/IceCream_1.jpg", answer: "real", label: "Ice cream cone" },
    { url: "images/IceCream_2.jpg", answer: "fake", label: "Ice cream cone" },

    { url: "images/Golden_1.jpg", answer: "real", label: "A golden retriever" },
    { url: "images/Golden_2.jpg", answer: "fake", label: "A golden retriever" },

    { url: "images/RollerCoaster_1.jpg", answer: "real", label: "Roller coaster" },
    { url: "images/RollerCoaster_2.jpg", answer: "fake", label: "Roller coaster" },

    { url: "images/Sunset_1.jpg", answer: "real", label: "A beach sunset" },
    { url: "images/Sunset_2.jpg", answer: "fake", label: "A beach sunset" },

    { url: "images/Soccer_1.jpg", answer: "real", label: "Soccer Field" },
    { url: "images/Soccer_2.jpg", answer: "fake", label: "Soccer Field" },

    { url: "images/Pizza_1.jpg", answer: "real", label: "Pizza with toppings" },
    { url: "images/Pizza_2.jpg", answer: "fake", label: "Pizza with toppings" },

    { url: "images/FireTruck_1.jpg", answer: "real", label: "Fire truck" },
    { url: "images/FireTruck_2.jpg", answer: "fake", label: "Fire truck" },

    { url: "images/Students_1.jpg", answer: "real", label: "Classroom with students" },
    { url: "images/Students_2.jpg", answer: "fake", label: "Classroom with students" },

    { url: "images/Deer_1.jpg", answer: "real", label: "A forest animal" },
    { url: "images/Deer_2.jpg", answer: "fake", label: "A forest animal" },
  ];

  // ‚úÖ Game limits
  const MAX_IMAGES = 20;
  const MAX_SECONDS = 60;

  let remainingImages = [];
  let currentImageStart = 0;
  let currentImageData = null;

  let answeredCount = 0;
  let gameStart = 0;
  let gameEnded = false;
  let timerInterval = null;

  // Track the single longest-viewed image
  let longestViewed = { label: "", seconds: 0, url: "" };

  function log(msg) {
    const logEl = document.getElementById("log");
    if (!logEl) return;
    const timestamp = new Date().toLocaleTimeString();
    logEl.innerHTML += `<p>[${timestamp}] ${msg}</p>`;
    logEl.scrollTop = logEl.scrollHeight;
  }

  function shuffle(arr) {
    return arr.sort(() => Math.random() - 0.5);
  }

  function initializeImages() {
    // start with a shuffled copy
    remainingImages = shuffle([...imageSet]);
  }

  function secondsElapsedSince(startMs) {
    return Math.max(0, Math.round((Date.now() - startMs) / 1000));
  }

  function shouldEndGame() {
    const timeUp = secondsElapsedSince(gameStart) >= MAX_SECONDS;
    const imagesDone = answeredCount >= MAX_IMAGES;
    return timeUp || imagesDone;
  }

  function endGame(reason) {
    if (gameEnded) return;
    gameEnded = true;

    if (timerInterval) clearInterval(timerInterval);

    log(`üèÅ Game ended: ${reason}`);

    const gameContainer = document.getElementById("game-container");
    const bestLabel = longestViewed.label || "No data";
    const bestTime = longestViewed.seconds || 0;

    gameContainer.innerHTML = `
      <h2>Conclusion</h2>
      <p>You answered <strong>${answeredCount}</strong> images in <strong>${secondsElapsedSince(gameStart)}s</strong>.</p>
      <p><strong>Longest viewed type:</strong> ${bestLabel} (${bestTime}s)</p>
      ${
        longestViewed.url
          ? `<img src="${longestViewed.url}" alt="Longest viewed" style="max-width:100%; max-height:320px; border-radius:8px; margin: 1rem auto; display:block;">`
          : ""
      }
      <button onclick="restartGame()" style="
        margin-top: 0.5rem;
        padding: 12px 18px;
        font-size: 1.1rem;
        font-weight: 700;
        background: #28a745;
        border: none;
        border-radius: 8px;
        color: white;
        cursor: pointer;
      ">Play Again</button>
    `;
  }

  function preloadAndShow(imgData) {
    const imgEl = document.getElementById("quiz-image");
    const pre = new Image();

    pre.onload = () => {
      if (gameEnded) return;

      currentImageData = imgData;
      currentImageStart = Date.now();

      imgEl.src = imgData.url;
      imgEl.setAttribute("data-label", imgData.label);
      imgEl.setAttribute("data-answer", imgData.answer);
      imgEl.setAttribute("data-url", imgData.url);
    };

    pre.onerror = () => {
      log(`‚ö†Ô∏è Failed to load image: ${imgData.url} (skipping)`);
      showImage(); // skip
    };

    pre.src = imgData.url;
  }

  function showImage() {
    if (gameEnded) return;

    if (shouldEndGame()) {
      endGame(answeredCount >= MAX_IMAGES ? `Reached ${MAX_IMAGES} images` : `Reached ${MAX_SECONDS} seconds`);
      return;
    }

    if (remainingImages.length === 0) initializeImages();
    const imgData = remainingImages.shift();
    preloadAndShow(imgData);
  }

  function submitGuess(userRating) {
    if (gameEnded) return;

    const imageEl = document.getElementById("quiz-image");
    const label = imageEl.getAttribute("data-label") || "Unknown";
    const answer = imageEl.getAttribute("data-answer") || "unknown";
    const url = imageEl.getAttribute("data-url") || "";

    // time on current image
    const viewSeconds = currentImageStart ? secondsElapsedSince(currentImageStart) : 0;

    // Track longest-viewed image
    if (viewSeconds > longestViewed.seconds) {
      longestViewed = { label, seconds: viewSeconds, url };
    }

    log(`Time viewing "${label}": ${viewSeconds}s`);

    // score message (optional)
    let verdict = "Not sure";
    if (userRating === 3) {
      verdict = "Not sure";
    } else if ((userRating >= 4 && answer === "real") || (userRating <= 2 && answer === "fake")) {
      verdict = "‚úÖ Correct";
    } else {
      verdict = "‚ùå Incorrect";
    }
    log(`You picked ${userRating} ‚Äî ${verdict}`);

    answeredCount++;

    if (shouldEndGame()) {
      endGame(answeredCount >= MAX_IMAGES ? `Reached ${MAX_IMAGES} images` : `Reached ${MAX_SECONDS} seconds`);
      return;
    }

    setTimeout(showImage, 450);
  }

  function restartGame() {
    // reset state
    remainingImages = [];
    currentImageStart = 0;
    currentImageData = null;

    answeredCount = 0;
    gameStart = Date.now();
    gameEnded = false;

    longestViewed = { label: "", seconds: 0, url: "" };

    // clear log
    document.getElementById("log").innerHTML = `<h2>Live Activity Log</h2>`;

    // restore game UI (in case we were on conclusion screen)
    document.getElementById("game-container").innerHTML = `
      <h2>Is this a Real Photo?</h2>
      <img id="quiz-image" class="image-display" src="" alt="Guess if this is real or AI" />

      <div class="scale-options" aria-label="Rating scale">
        <span class="label">FAKE</span>
        <button onclick="submitGuess(1)">1</button>
        <button onclick="submitGuess(2)">2</button>
        <button onclick="submitGuess(3)">3</button>
        <button onclick="submitGuess(4)">4</button>
        <button onclick="submitGuess(5)">5</button>
        <span class="label">REAL</span>
      </div>
    `;

    // start
    initializeImages();
    showImage();

    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      if (!gameEnded && shouldEndGame()) {
        endGame(`Reached ${MAX_SECONDS} seconds`);
      }
    }, 250);

    log("üîÅ Restarted game");
  }

  // ‚úÖ Theme syncing (from earlier)
  function syncDarkModeClass() {
    const mq = window.matchMedia("(prefers-color-scheme: dark)");
    const prefersDark = mq.matches;

    document.body.classList.toggle("dark", prefersDark);

    const dm = document.getElementById("darkMode");
    if (dm) dm.textContent = prefersDark ? "Enabled" : "Disabled";
  }

  window.addEventListener("DOMContentLoaded", () => {
    // Device info
    document.getElementById("userAgent").textContent = navigator.userAgent;
    document.getElementById("screenRes").textContent = `${screen.width} x ${screen.height}`;
    document.getElementById("platform").textContent = navigator.platform || "Unknown";
    document.getElementById("language").textContent = navigator.language || "Unknown";

    const ua = navigator.userAgent || "";
    document.getElementById("deviceType").textContent =
      /Tablet|iPad/i.test(ua) ? "Tablet" : /Mobi|Android/i.test(ua) ? "Mobile" : "Desktop";

    document.getElementById("touchSupport").textContent =
      ("ontouchstart" in window || navigator.maxTouchPoints > 0) ? "Yes" : "No";

    // Theme
    syncDarkModeClass();
    const mq = window.matchMedia("(prefers-color-scheme: dark)");
    if (mq.addEventListener) mq.addEventListener("change", syncDarkModeClass);
    else mq.addListener(syncDarkModeClass);

    // Start game
    gameStart = Date.now();
    initializeImages();
    showImage();

    timerInterval = setInterval(() => {
      if (!gameEnded && shouldEndGame()) {
        endGame(`Reached ${MAX_SECONDS} seconds`);
      }
    }, 250);

    log("Website loaded");
  });
</script>
</body>
</html>
